<!DOCTYPE html>
<html>
<head>
    <title>GeliÅŸmiÅŸ Sohbet</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; height: 100vh; margin: 0; background: #f0f0f0; }
        #sidebar { width: 250px; background: #333; color: white; padding: 15px; border-right: 2px solid #555; display: flex; flex-direction: column; }
        #sidebar h3 { margin-top: 0; }
        #chat-list { list-style: none; padding: 0; margin: 10px 0; }
        #chat-list li { padding: 10px; cursor: pointer; border-radius: 5px; margin-bottom: 5px; }
        #chat-list li:hover, #chat-list li.active { background: #555; }
        #your-id-container { margin-top: auto; font-size: 12px; word-break: break-all; }
        #main-chat { flex-grow: 1; display: flex; flex-direction: column; padding: 20px; }
        #mesajlar { background: white; height: 100%; overflow-y: scroll; padding: 15px; border: 2px solid #ccc; border-radius: 8px; margin-bottom: 10px; }
        .mesaj { background: #e3f2fd; padding: 8px 12px; margin: 6px 0; border-radius: 15px; max-width: 70%; }
        .mesaj strong { color: #0d47a1; }
        #input-area { display: flex; }
        #mesajInput { flex-grow: 1; padding: 10px; font-size: 16px; border: 2px solid #ccc; border-radius: 5px; }
        button { padding: 10px 20px; font-size: 16px; background: #4CAF50; color: white; border: none; cursor: pointer; margin-left: 10px; border-radius: 5px; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; display: flex; justify-content: center; align-items: center; text-align: center; z-index: 100; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div>
            <h2>Sohbete KatÄ±l</h2>
            <input id="kullaniciAdiInput" type="text" placeholder="KullanÄ±cÄ± adÄ±nÄ± yaz...">
            <button onclick="sohbeteKatil()">KATIL</button>
        </div>
    </div>

    <div id="sidebar">
        <h3>Sohbetler</h3>
        <ul id="chat-list">
            <li onclick="loadChat('public_chat')" class="active" data-chatid="public_chat"># Genel Sohbet</li>
        </ul>
        <button onclick="startPrivateChat()">Ã–zel Sohbet BaÅŸlat</button>
        <div id="your-id-container">
            <p><strong>KullanÄ±cÄ± AdÄ±n:</strong> <span id="kullanici-adi-goster"></span></p>
            <p><strong>PaylaÅŸÄ±lacak ID'n:</strong><br><span id="your-id"></span></p>
        </div>
    </div>

    <div id="main-chat">
        <div id="mesajlar"></div>
        <div id="input-area">
            <input id="mesajInput" type="text" placeholder="MesajÄ±nÄ± yaz...">
            <button onclick="mesajGonder()">GÃ–NDER</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC5XS00Wu02kEVYj5thRuDXl8zhLQrRDR4",
            authDomain: "chatuygulama-cbf18.firebaseapp.com",
            databaseURL: "https://chatuygulama-cbf18-default-rtdb.firebaseio.com",
            projectId: "chatuygulama-cbf18",
            storageBucket: "chatuygulama-cbf18.firebasestorage.app",
            messagingSenderId: "881374423023",
            appId: "1:881374423023:web:8b17a88119d9123295381a",
            measurementId: "G-9FSZXNYLBD"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let myUsername = '';
        let myId = '';
        let currentChatId = 'public_chat';
        let currentChatListener = null;

        function generateUniqueId() {
            let id = localStorage.getItem('myChatAppId');
            if (!id) {
                id = 'user-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('myChatAppId', id);
            }
            return id;
        }

        function sohbeteKatil() {
            myUsername = document.getElementById('kullaniciAdiInput').value;
            if (myUsername) {
                localStorage.setItem('myChatAppUsername', myUsername);
                document.getElementById('login-screen').style.display = 'none';
                initApp();
            } else {
                alert('LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin!');
            }
        }
        
        function initApp() {
            myId = generateUniqueId();
            myUsername = localStorage.getItem('myChatAppUsername');
            
            if (!myUsername) {
                document.getElementById('login-screen').style.display = 'flex';
                return;
            }
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('your-id').textContent = myId;
            document.getElementById('kullanici-adi-goster').textContent = myUsername;

            loadChat('public_chat');
        }

        function loadChat(chatId, otherUsername = null) {
            if (currentChatListener) {
                database.ref('chats/' + currentChatId).off('child_added', currentChatListener);
            }
            
            currentChatId = chatId;
            document.getElementById('mesajlar').innerHTML = '';

            document.querySelectorAll('#chat-list li').forEach(li => li.classList.remove('active'));
            const activeLi = document.querySelector(`#chat-list li[data-chatid="${chatId}"]`);
            if (activeLi) {
                activeLi.classList.add('active');
            } else {
                const newLi = document.createElement('li');
                newLi.textContent = `ðŸ”’ ${otherUsername}`;
                newLi.dataset.chatid = chatId;
                newLi.className = 'active';
                newLi.onclick = () => loadChat(chatId, otherUsername);
                document.getElementById('chat-list').appendChild(newLi);
            }
            
            currentChatListener = database.ref('chats/' + chatId).on('child_added', (snapshot) => {
                const mesaj = snapshot.val();
                const div = document.createElement('div');
                div.className = 'mesaj';
                div.innerHTML = `<strong>${mesaj.kullanici}:</strong> ${mesaj.metin}`;
                document.getElementById('mesajlar').appendChild(div);
                document.getElementById('mesajlar').scrollTop = 999999;
            });
        }
        
        function mesajGonder() {
            const mesajInput = document.getElementById('mesajInput');
            const mesaj = mesajInput.value;
            if (mesaj) {
                database.ref('chats/' + currentChatId).push({
                    kullanici: myUsername,
                    metin: mesaj,
                    zaman: Date.now()
                });
                mesajInput.value = '';
            }
        }
        
        function startPrivateChat() {
            const otherUserId = prompt("KonuÅŸmak istediÄŸin kiÅŸinin ID'sini buraya yapÄ±ÅŸtÄ±r:");
            if (otherUserId && otherUserId !== myId) {
                const otherUsername = prompt("O kiÅŸinin kullanÄ±cÄ± adÄ± nedir? (Sohbet listesinde gÃ¶zÃ¼kmesi iÃ§in)");
                const ids = [myId, otherUserId].sort();
                const privateChatId = ids.join('-');
                loadChat(privateChatId, otherUsername);
            } else if (otherUserId === myId) {
                alert("Kendinle Ã¶zel sohbet baÅŸlatamazsÄ±n!");
            }
        }

        document.getElementById('mesajInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') mesajGonder();
        });
        document.getElementById('kullaniciAdiInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sohbeteKatil();
        });

        window.onload = initApp;
    </script>
</body>
</html>
